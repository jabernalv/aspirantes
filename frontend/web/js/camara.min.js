const tieneSoporteUserMedia=()=>!!(navigator.getUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia),_getUserMedia=(...arguments)=>(navigator.getUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia).apply(navigator,arguments),$video=document.querySelector("#video"),$canvas=document.querySelector("#canvas"),$estado=document.querySelector("#estado"),$foto_button=document.querySelector("#foto-button"),$listaDeDispositivos=document.querySelector("#listaDeDispositivos"),limpiarSelect=()=>{for(let e=$listaDeDispositivos.options.length-1;e>=0;e--)$listaDeDispositivos.remove(e)},obtenerDispositivos=()=>navigator.mediaDevices.enumerateDevices();var site_foto_url;const llenarSelectConDispositivosDisponibles=()=>{limpiarSelect(),obtenerDispositivos().then(e=>{const t=[];e.forEach(e=>{"videoinput"===e.kind&&t.push(e)}),t.length>0&&t.forEach(e=>{const t=document.createElement("option");t.value=e.deviceId,t.text=e.label,$listaDeDispositivos.appendChild(t)})})};!function(){if(!tieneSoporteUserMedia())return alert("Lo siento. Tu navegador no soporta esta caracteristica"),void($estado.innerHTML="Parece que tu navegador no soporta esta caracteristica. Intenta actualizarlo.");let e;obtenerDispositivos().then(e=>{const o=[];e.forEach(function(e){"videoinput"===e.kind&&o.push(e)}),o.length>0&&t(o[0].deviceId)});const t=o=>{_getUserMedia({video:{deviceId:o}},o=>{limpiarSelect(),obtenerDispositivos().then(e=>{const t=[];e.forEach(e=>{"videoinput"===e.kind&&t.push(e)}),t.length>0&&t.forEach(e=>{const t=document.createElement("option");t.value=e.deviceId,t.text=e.label,$listaDeDispositivos.appendChild(t)})}),$listaDeDispositivos.onchange=(()=>{e&&e.getTracks().forEach(function(e){e.stop()}),t($listaDeDispositivos.value)}),e=o,$video.srcObject=e,$video.play(),$foto_button.addEventListener("click",function(){$video.pause();let e=$canvas.getContext("2d");$canvas.width=$video.videoWidth,$canvas.height=$video.videoHeight,e.drawImage($video,0,0,$canvas.width,$canvas.height);let t=$canvas.toDataURL();$estado.innerHTML="Enviando foto. Por favor, espere ...",console.log(site_foto_url),fetch(site_foto_url,{method:"POST",body:encodeURIComponent(t),headers:{"Content-type":"application/x-www-form-urlencoded"}}).then(e=>e.text()).then(e=>{var t=JSON.parse(e);$estado.innerHTML=`Foto guardada con exito. Puede verla <a target='_blank' href='${t.message}'> aqui</a>`}),$video.play()})},e=>{console.log("Permiso denegado o error: ",e),$estado.innerHTML="No se puede acceder a la camara, o no diste permiso."})}}();


